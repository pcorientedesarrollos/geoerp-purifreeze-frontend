<mat-card class="page-card">
  <div class="page-header">
    <mat-card-title>
      <mat-icon>directions_car</mat-icon>
      <h1>Cat치logo de Unidades</h1>
    </mat-card-title>
    <span class="spacer"></span>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="openUnidadDialog()">
        <mat-icon>add</mat-icon>
        <span>Agregar Unidad</span>
      </button>
    </div>
  </div>

  <mat-card-content>
    <!-- MEJORA: Bloque @if / @else if / @else para manejar todos los estados de la vista -->
    @if (isLoading()) {
      <div class="loading-container">
        <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
        <p>Cargando unidades...</p>
      </div>
    } @else if (errorOcurred()) {
      <div class="no-data-message">
        <mat-icon>error_outline</mat-icon>
        <p>Ocurri칩 un error al cargar los datos.</p>
        <button mat-stroked-button color="primary" (click)="loadUnidades()">Reintentar</button>
      </div>
    } @else {
      <!-- Contenido principal cuando no hay carga ni error -->
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Filtrar unidades...</mat-label>
        <!-- MEJORA: Conectado a FormControl -->
        <input matInput [formControl]="filterControl" placeholder="Ej. Nissan">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      @if (unidades().length === 0) {
        <div class="no-data-message">
          <mat-icon>no_transfer</mat-icon>
          <p>No hay unidades registradas.</p>
        </div>
      } @else {
        <div class="table-container">
          <table mat-table [dataSource]="dataSource" matSort>
            <!-- Columnas (sin cambios en la definici칩n) -->
            <ng-container matColumnDef="nombreUnidad"><th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre </th><td mat-cell *matCellDef="let row"> {{row.nombreUnidad}} </td></ng-container>
            <ng-container matColumnDef="placaUnidad"><th mat-header-cell *matHeaderCellDef mat-sort-header> Placa </th><td mat-cell *matCellDef="let row"> {{row.placaUnidad}} </td></ng-container>
            <ng-container matColumnDef="marcaUnidad"><th mat-header-cell *matHeaderCellDef mat-sort-header> Marca </th><td mat-cell *matCellDef="let row"> {{row.marcaUnidad}} </td></ng-container>
            <ng-container matColumnDef="modeloUnidad"><th mat-header-cell *matHeaderCellDef mat-sort-header> Modelo </th><td mat-cell *matCellDef="let row"> {{row.modeloUnidad}} </td></ng-container>
            <ng-container matColumnDef="unidadActiva"><th mat-header-cell *matHeaderCellDef mat-sort-header> Estado </th><td mat-cell *matCellDef="let row"> {{row.unidadActiva ? 'Activa' : 'Inactiva'}} </td></ng-container>
            <ng-container matColumnDef="acciones">
              <th mat-header-cell *matHeaderCellDef> Acciones </th>
              <td mat-cell *matCellDef="let row">
                <button mat-icon-button color="primary" (click)="openUnidadDialog(row)" matTooltip="Editar Unidad"><mat-icon>edit</mat-icon></button>
                <button mat-icon-button color="warn" (click)="deleteUnidad(row.idUnidadTransporte)" matTooltip="Eliminar Unidad"><mat-icon>delete</mat-icon></button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            <tr class="mat-row" *matNoDataRow>
              <!-- MEJORA: Lectura del valor desde el FormControl -->
              <td class="mat-cell" colspan="6" align="center">No se encontraron unidades para el filtro "{{filterControl.value}}"</td>
            </tr>
          </table>
          <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Seleccionar p치gina de unidades"></mat-paginator>
        </div>
      }
    }
  </mat-card-content>
</mat-card>